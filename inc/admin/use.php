<?php/* * @package Admin page functions * @subpackage I2s Ingenierie * Developed by @5Baddi */i2s_admin_alert('Paramètres mis à jour avec succès.');// Admin Menu pagesfunction i2s_admin_menu(){    // Home menu    add_menu_page('Contrôles de thème', get_bloginfo('name'), 'edit_theme_options', 'i2s', 'i2s_admin_home', i2s_assets('ico/favicon-16x16.png'), 3);    // Info page    add_submenu_page('i2s', 'I2s Ingenierie Coordennées', 'I2s Coordennées', 'edit_theme_options', 'i2s_info', 'i2s_info_page');    // Front page    add_submenu_page('i2s', 'Page de garde', 'Page de garde', 'edit_theme_options', 'i2s_front', 'i2s_front_page');    // Mail page    add_submenu_page('i2s', 'Envoyer des fichiers', 'Envoyer des fichiers', 'edit_theme_options', 'i2s_mail', 'i2s_mail_page');    // Remove home menu replayed    remove_submenu_page('i2s', 'i2s');}/* * Include HTML Admin page */// Info pagefunction i2s_info_page(){    $gets = get_option('i2s_up_info');    require_once 'info.php';}// Front pagefunction i2s_front_page(){    $gets = get_option('i2s_up_static');    require_once 'static.php';}// Mail pagefunction i2s_mail_page(){    require_once 'mail.php';}/* * Admin Enqueue Script */function i2s_admin_scripts(){    // Media Script    wp_enqueue_media();    // Admin Options Script    wp_enqueue_script('i2s-admin-options', get_template_directory_uri().'/inc/admin/options.js', array('jquery'), '1.0.0', true);}/* * Intial admin page */function i2s_admin_init(){    // Save Info page data    add_action('admin_post_i2s_save_info', 'i2s_save_info');    // Save Front page data    add_action('admin_post_i2s_save_static', 'i2s_save_static');    // Contact form    add_action('admin_post_contact_form', 'contact_form');    // Admin Send Mail    add_action('admin_post_i2s_admin_send_mail', 'i2s_admin_send_mail');    // Add Link input for Partner post type    add_action('add_meta_boxes', 'i2s_partner_link_input');    // Save Partner Link    add_action('save_post', 'i2s_partner_save_link', 10, 2);    // Manage Partner logo column    add_action('manage_edit-partner_columns', 'i2s_partner_columns');    // Show Partner Logo in column    add_action('manage_posts_custom_column', 'i2s_partner_column');}/* * Admin page error alert */function i2s_admin_alert($msg){    $status = intval($_GET['status']);    if(isset($status) && !empty($status)):        if($status == 1):            echo '<div class="updated"><p>'.$msg.'</p></div>';        elseif($status == 0):            echo '<div class="update-nag"><p>Une erreur s\'est produite! Réessayez &hellip;</p></div>';        endif;    endif;}/* * Partner Link input */function i2s_partner_link_input(){    add_meta_box('partner_link', 'Partner Website', 'i2s_partner_link', 'partner', 'normal', 'high');}/* * Partner link */function i2s_partner_link($object){    wp_nonce_field('partner_verify', 'partner_link_nonce');    echo'        <div class="meta-box-item-title">            <h4>Lien de ce partner :</h4>        </div>        <div class="meta-box-item-content">            <input type="url" name="partner_link" style="width:100%;" placeholder="https://www.partner.domain" value="'.esc_url(get_post_meta($object->ID, '_partner_link', true)).'"/>        </div>    ';}/* * Save Partner link */function i2s_partner_save_link($post_id, $post){    $link = esc_url_raw($_POST['partner_link']);    if(!isset($link) || !wp_verify_nonce($_POST['partner_link_nonce'], 'partner_verify')){        return $post_id;    }    $type = get_post_type_object($post->post_type);    if(!current_user_can($type->cap->edit_post)){        return $post_id;    }    update_post_meta($post_id, '_partner_link', $link);}/* * Partner Thumbnail column */function i2s_partner_columns($columns){    $thumb = array('thumbnail' => 'Logo');    $columns = array_slice($columns, 0, 1) + $thumb + array_slice($columns, 1, null);    return $columns;}/* * Show Partner Logo in Column */function i2s_partner_column($column){    global $post;    if($column == 'thumbnail'){        echo edit_post_link(get_the_post_thumbnail($post->ID, 'partners'), null, null, $post->ID);    }}/* * Admin pages functions */function i2s_save_info(){    // Check user capability    if(!current_user_can('edit_theme_options')){        return;    }    // Admin page token    check_admin_referer('i2s_verify_info');    // Grap the data    $info = get_option('i2s_up_info');    $desc = sanitize_text_field(stripslashes_deep($_POST['info_description']));    $title = sanitize_text_field($_POST['info_title']);    $info['info_title'] = (!empty($title)) ? $title : get_bloginfo('name');    $info['info_desc'] = (!empty($desc)) ? $desc : get_bloginfo('description');    $info['info_mail'] = sanitize_text_field($_POST['info_email']);    $info['info_gsm'] = sanitize_text_field($_POST['info_gsm']);    $info['info_tel'] = sanitize_text_field($_POST['info_tel']);    $info['info_fax'] = sanitize_text_field($_POST['info_fax']);    $info['info_adr'] = sanitize_text_field($_POST['info_address']);    // Put the data to DB    $status = 0 ;    if(update_option('i2s_up_info', $info)){        $status = 1;    }    // Finally Redirect to main info page    wp_redirect(admin_url('admin.php?page=i2s_info&status='.$status));}function i2s_save_static(){    // Check user capability    if(!current_user_can('edit_theme_options')){        return;    }    // Admin page token    check_admin_referer('i2s_verify_static');    // Grap textarea data    $static = get_option('i2s_up_static');    $static['static_first'] = array(stripslashes_deep(sanitize_textarea_field($_POST['first_static'])), stripslashes_deep(sanitize_textarea_field($_POST['first_title_static'])), stripslashes_deep(sanitize_textarea_field($_POST['first_icon_static'])));    $static['static_second'] = array(stripslashes_deep(sanitize_textarea_field($_POST['second_static'])), stripslashes_deep(sanitize_textarea_field($_POST['second_title_static'])), stripslashes_deep(sanitize_textarea_field($_POST['second_icon_static'])));    $static['static_third'] = array(stripslashes_deep(sanitize_textarea_field($_POST['third_static'])), stripslashes_deep(sanitize_textarea_field($_POST['third_title_static'])), stripslashes_deep(sanitize_textarea_field($_POST['third_icon_static'])));    // Put the data to DB    $status = 0;    if(update_option('i2s_up_static', $static)){        $status = 1;    }    // Redirect to main static page    wp_redirect('admin.php?page=i2s_front&status='.$status);}// Enable Html Mailfunction i2s_enable_html_mail(){    return 'text/html';}// Send Mailfunction i2s_admin_send_mail(){    // Check user capability    if(!current_user_can('edit_theme_options')){        return;    }    // Admin page token    check_admin_referer('i2s_verify_mail');    // Grap the data    $mail['to'] = sanitize_email($_POST['to']);    $mail['msg'] = sanitize_textarea_field($_POST['msg']);    // Mail content    $msg = '<a href="'.esc_url(home_url('/')).'">i2s Ingenierie</a><p>'.$mail['msg'].'</p>';    // Enable Html Mail    i2s_enable_html_mail();    add_filter('wp_mail_content_type', 'i2s_enable_html_mail');    $status = 0 ;    if(wp_mail('mohamed@baddi.info', 'test', $msg)){        $status = 1;    }    remove_filter('wp_mail_content_type', 'i2s_enable_html_mail');    // Finally Redirect to main info page    wp_redirect(admin_url('admin.php?page=i2s_mail&status='.$status));}